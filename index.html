<!DOCTYPE html>
<html>
<head>
  <title>Mini Trading</title>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      background:#111;
      color:white;
      font-family:Arial;
      text-align:center;
      padding:40px;
    }

    select, button {
      padding:10px;
      margin:10px;
    }

    canvas {
      max-width:900px;
      margin:40px auto;
      display:block;
    }
  </style>
</head>

<body>

<h1>Mini Trading ðŸ“ˆ</h1>

<select id="tickerSelect"></select>
<button onclick="loadData()">Carregar</button>

<canvas id="priceChart"></canvas>

<script>
  const { createClient } = supabase;

  const client = createClient(
    "https://vlqteefeuxhovubojybd.supabase.co",
    "sb_publishable_KmHWU0IJzCkwXBWzWMe1WQ_M-sSaxk0"
  );

  let chart;

  async function loadTickers() {
    const { data, error } = await client
      .from("prices")
      .select("ticker");

    if (error) return;

    const uniqueTickers = [...new Set(data.map(item => item.ticker))];

    const select = document.getElementById("tickerSelect");
    select.innerHTML = "";

    uniqueTickers.forEach(ticker => {
      const option = document.createElement("option");
      option.value = ticker;
      option.textContent = ticker;
      select.appendChild(option);
    });
  }

  async function loadData() {
    const ticker = document.getElementById("tickerSelect").value;

    const { data, error } = await client
      .from("prices")
      .select("*")
      .eq("ticker", ticker)
      .order("date", { ascending: true });

    if (error) return;

    const labels = data.map(item => item.date);
    const prices = data.map(item => parseFloat(item.price));

    if (chart) {
      chart.destroy();
    }

    const ctx = document.getElementById("priceChart").getContext("2d");

    chart = new Chart(ctx, {
      type: "line",
      data: {
        labels: labels,
        datasets: [{
          label: ticker,
          data: prices,
          borderColor: "#4CAF50",
          backgroundColor: "rgba(76,175,80,0.1)",
          borderWidth: 2,
          tension: 0.2
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: {
            labels: { color: "white" }
          }
        },
        scales: {
          x: {
            ticks: { color: "white" },
            grid: { color: "#222" }
          },
          y: {
            ticks: { color: "white" },
            grid: { color: "#222" }
          }
        }
      }
    });
  }

  loadTickers();
</script>

</body>
</html>
